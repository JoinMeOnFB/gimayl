<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>PIN — Gmail-style</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
  :root{
    --bg-page:#f6f8fc;
    --card-bg:rgba(255,255,255,0.98);
    --accent:#d23f31;
    --accent-pressed:#b02e23;
    --muted:#5f6368;
    --danger:#d93025;
    --glass-radius:8px;
    --btn-radius:6px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter, Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
    background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 25%, #ef9a9a 50%, #e57373 75%, #ef5350 100%);
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:16px;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow-x:hidden;
  }

  /* Card with enhanced animations */
  .card{
    width:100%;
    max-width:420px;
    background:var(--card-bg);
    border-radius:12px;
    padding:28px;
    box-shadow:0 10px 30px rgba(183, 28, 28, 0.15);
    text-align:center;
    transform:translateZ(0);
    animation:cardFloat 6000ms ease-in-out infinite;
    border: 1px solid rgba(229, 115, 115, 0.2);
  }
  
  @keyframes cardFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-8px) rotate(0.5deg); }
  }

  .avatar{
    width:84px;height:84px;border-radius:50%;margin:0 auto 16px;
    background:#ffebee;display:flex;align-items:center;justify-content:center;
    border:2px solid #ef9a9a;font-size:32px;color:#d32f2f;
    animation:avatarGlow 4000ms ease-in-out infinite;
  }
  
  @keyframes avatarGlow {
    0%, 100% { box-shadow: 0 0 0px rgba(210, 63, 49, 0.3); }
    50% { box-shadow: 0 0 12px rgba(210, 63, 49, 0.6); }
  }

  h1{font-size:20px;margin:8px 0 4px;color:#c62828;font-weight:600}
  p.lead{margin:0 0 18px;color:#d32f2f;font-size:15px;line-height:1.35}

  /* PIN dots with enhanced animations */
  .pin-row{display:flex;gap:12px;justify-content:center;margin-bottom:20px}
  .dot{
    width:16px;height:16px;border-radius:50%;background:#ffcdd2;
    transition:transform .18s cubic-bezier(.2,.9,.2,1), background .18s;
    animation:dotPulse 3000ms ease-in-out infinite;
    animation-delay: calc(var(--i, 0) * 200ms);
  }
  
  @keyframes dotPulse {
    0%, 100% { transform: scale(1); opacity: 0.8; }
    50% { transform: scale(1.1); opacity: 1; }
  }

  .dot.filled{
    background:var(--accent);
    animation:filledPulse 1500ms ease-in-out infinite;
    transform:scale(1.15);
  }
  
  @keyframes filledPulse {
    0%, 100% { transform: scale(1.15); box-shadow: 0 0 0px rgba(210, 63, 49, 0.4); }
    50% { transform: scale(1.25); box-shadow: 0 0 8px rgba(210, 63, 49, 0.8); }
  }

  /* keypad grid */
  .keypad{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:12px;
    margin-bottom:12px;
  }

  /* iOS6-style button with enhanced animations */
  .key{
    --base:var(--accent);
    --base-pressed:var(--accent-pressed);
    height:62px;
    background:
      linear-gradient(to bottom, rgba(255,255,255,0.18) 0%, rgba(255,255,255,0.06) 45%, rgba(0,0,0,0.04) 100%),
      var(--base);
    color:#fff;
    border-radius:var(--btn-radius);
    border:1px solid rgba(0,0,0,0.18);
    box-shadow:0 1px 0 rgba(255,255,255,0.25) inset, 0 2px 0 rgba(0,0,0,0.06);
    display:flex;align-items:center;justify-content:center;
    font-weight:700;font-size:20px;
    cursor:pointer;
    user-select:none;
    -webkit-tap-highlight-color:transparent;
    transition:all .15s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    will-change:transform;
    animation:keyFloat 5000ms ease-in-out infinite;
    animation-delay: calc(var(--key-delay, 0) * 100ms);
  }
  
  @keyframes keyFloat {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-2px); }
  }

  .key:active{
    transform:scale(0.92) rotate(-1deg);
    background:linear-gradient(to bottom, rgba(0,0,0,0.06) 0%, rgba(0,0,0,0.12) 100%), var(--base-pressed);
    animation:none;
  }
  
  @media (pointer:fine){
    .key:hover{
      transform:translateY(-6px) scale(1.05);
      box-shadow:0 12px 25px rgba(183, 28, 28, 0.2);
    }
  }

  /* transparent spacer cell */
  .spacer{background:transparent;border:0;height:62px}

  /* delete key icon */
  .key.icon{font-size:18px;display:flex;gap:8px;align-items:center;justify-content:center}
  .key.disabled{opacity:.68;pointer-events:none}

  /* status & footer */
  .status{height:20px;margin:6px 0 0;color:var(--danger);font-size:14px}
  .footer{
    margin-top:14px;
    color:#d32f2f;
    font-size:13px;
    animation:textShimmer 6000ms ease-in-out infinite;
  }
  
  @keyframes textShimmer {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
  }

  /* Enhanced micro-animations */
  .pulse{
    display:inline-block;
    transform-origin:center center;
    animation:idlePulse 2500ms ease-in-out infinite;
    opacity:.98;
  }
  
  @keyframes idlePulse{
    0%{transform:scale(1) rotate(0deg);}
    33%{transform:scale(1.008) rotate(0.2deg);}
    66%{transform:scale(0.998) rotate(-0.1deg);}
    100%{transform:scale(1) rotate(0deg);}
  }

  /* Success celebration */
  .celebrate {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1000;
  }

  /* Background elements for calm red aesthetic */
  .bg-bubble {
    position: fixed;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    animation: floatBubble 15s infinite linear;
    z-index: -1;
  }

  @keyframes floatBubble {
    0% { transform: translateY(100vh) scale(0); opacity: 0; }
    10% { opacity: 0.3; }
    90% { opacity: 0.2; }
    100% { transform: translateY(-100px) scale(1); opacity: 0; }
  }

  /* responsive tweaks */
  @media (max-width:420px){
    .card{padding:20px;border-radius:10px}
    .key{height:58px;font-size:18px}
  }
</style>
</head>
<body>
  <!-- Background bubbles -->
  <div id="bubbles"></div>

  <main class="card pulse" role="main" aria-labelledby="title">
    <div class="avatar" aria-hidden="true"><i class="fas fa-user"></i></div>
    <h1 id="title">User Account</h1>
    <p class="lead">Enter your 4-digit PIN to access Gmail</p>

    <div class="pin-row" id="pinRow" aria-hidden="false">
      <div class="dot" data-index="0" style="--i:0"></div>
      <div class="dot" data-index="1" style="--i:1"></div>
      <div class="dot" data-index="2" style="--i:2"></div>
      <div class="dot" data-index="3" style="--i:3"></div>
    </div>

    <div class="keypad" id="keypad" aria-hidden="false">
      <!-- buttons inserted by JS for minimal DOM and better performance -->
    </div>

    <div class="status" id="status" aria-live="polite"></div>
    <div class="footer">Forgot PIN? Contact support</div>
  </main>

<script>
/* Enhanced PIN entry with calm red background */

const PIN_LENGTH = 4;
let entered = '';
const dots = document.querySelectorAll('.dot');
const statusEl = document.getElementById('status');
const keypadEl = document.getElementById('keypad');

/* Create calming background bubbles */
function createBubbles() {
  const bubblesContainer = document.getElementById('bubbles');
  for (let i = 0; i < 12; i++) {
    const bubble = document.createElement('div');
    bubble.className = 'bg-bubble';
    const size = 20 + Math.random() * 80;
    const left = Math.random() * 100;
    const duration = 15 + Math.random() * 20;
    const delay = Math.random() * 15;
    
    Object.assign(bubble.style, {
      width: `${size}px`,
      height: `${size}px`,
      left: `${left}%`,
      animationDelay: `${delay}s`,
      animationDuration: `${duration}s`
    });
    
    bubblesContainer.appendChild(bubble);
  }
}

createBubbles();

/* Button layout */
const layout = [
  '1','2','3',
  '4','5','6',
  '7','8','9',
  'sp','0','del'
];

/* Create buttons with staggered animation delays */
const fragment = document.createDocumentFragment();
layout.forEach((key, index)=>{
  const el = document.createElement('button');
  if(key==='sp'){
    el.className='spacer';
    el.setAttribute('aria-hidden','true');
    el.disabled = true;
  } else {
    el.className = key==='del' ? 'key icon' : 'key';
    el.type = 'button';
    el.dataset.value = key==='del' ? 'del' : key;
    el.style.setProperty('--key-delay', index);
    el.setAttribute('aria-label', key==='del' ? 'delete' : `digit ${key}`);
    el.innerHTML = key==='del' ? '<i class="fas fa-delete-left"></i>' : key;
    el.addEventListener('click', onKey);
  }
  fragment.appendChild(el);
});
keypadEl.appendChild(fragment);

/* Mock fetch function */
async function fetchPinFromRemote(){
  await new Promise(r=>setTimeout(r, 180));
  return '8423';
}

/* Cache remote PIN */
let remotePin = null;
let fetching = null;
function ensureRemotePin(){
  if(remotePin) return Promise.resolve(remotePin);
  if(fetching) return fetching;
  fetching = fetchPinFromRemote()
    .then(pin => { remotePin = String(pin).trim(); return remotePin; })
    .catch(err => { console.warn('PIN fetch failed:', err); return null; })
    .finally(()=> fetching = null);
  return fetching;
}

/* update visuals */
function updateDots(){
  dots.forEach((d,i)=> {
    const wasFilled = d.classList.contains('filled');
    const isFilled = i < entered.length;
    
    if(isFilled && !wasFilled) {
      // New fill - bounce animation
      d.style.animation = 'none';
      setTimeout(() => {
        d.style.animation = 'filledPulse 1500ms ease-in-out infinite';
      }, 10);
    }
    
    d.classList.toggle('filled', isFilled);
  });
}

/* Enhanced key press animation */
function playKeyAnimation(el){
  el.style.animation = 'none';
  el.style.transform = 'scale(0.85) rotate(-3deg)';
  
  // Create ripple effect
  const rect = el.getBoundingClientRect();
  const ripple = document.createElement('div');
  ripple.style.cssText = `
    position: fixed;
    width: 60px; height: 60px;
    border-radius: 50%;
    background: rgba(210, 63, 49, 0.3);
    left: ${rect.left + rect.width/2 - 30}px;
    top: ${rect.top + rect.height/2 - 30}px;
    pointer-events: none;
    z-index: 100;
    animation: rippleExpand 400ms ease-out forwards;
  `;
  
  document.body.appendChild(ripple);
  setTimeout(() => ripple.remove(), 400);
  
  // Restore animation
  setTimeout(() => {
    el.style.transform = '';
    el.style.animation = `keyFloat 5000ms ease-in-out ${el.style.getPropertyValue('--key-delay') * 100}ms infinite`;
  }, 150);
}

/* Enhanced ripple animation */
const style = document.createElement('style');
style.textContent = `
  @keyframes rippleExpand {
    0% { transform: scale(0.5); opacity: 1; }
    100% { transform: scale(2); opacity: 0; }
  }
`;
document.head.appendChild(style);

/* key handler */
async function onKey(e){
  const v = this.dataset.value;
  if(v === 'del'){
    if(!entered) return;
    entered = entered.slice(0,-1);
    updateDots();
    statusEl.textContent = '';
    playKeyAnimation(this);
    return;
  }
  if(entered.length >= PIN_LENGTH) return;
  entered += v;
  updateDots();
  playKeyAnimation(this);
  
  if(entered.length === PIN_LENGTH){
    statusEl.textContent = 'Checking…';
    statusEl.style.opacity = '0';
    statusEl.style.transform = 'translateY(-10px)';
    statusEl.style.transition = 'all 0.3s ease';
    
    setTimeout(() => {
      statusEl.style.opacity = '1';
      statusEl.style.transform = 'translateY(0)';
    }, 50);
    
    const pin = await ensureRemotePin();
    await new Promise(r=>setTimeout(r, 220));
    
    if(pin && entered === pin){
      statusEl.style.color = '';
      statusEl.textContent = 'Success! Redirecting...';
      successFlow();
    } else {
      statusEl.style.color = 'var(--danger)';
      statusEl.textContent = 'Incorrect PIN. Try again.';
      shakeAndClear();
    }
  }
}

/* Enhanced success animation */
function successFlow(){
  // Create celebration container
  const celebrate = document.createElement('div');
  celebrate.className = 'celebrate';
  document.body.appendChild(celebrate);
  
  // Enhanced confetti with red theme colors
  const colors = ['#d23f31', '#ef5350', '#e57373', '#f44336', '#ef9a9a', '#ff8a80'];
  
  for(let i=0;i<25;i++){
    const c = document.createElement('div');
    const color = colors[Math.floor(Math.random() * colors.length)];
    const size = 6 + Math.random() * 8;
    const angle = Math.random() * 360;
    
    Object.assign(c.style,{
      position:'fixed',
      left: (30 + Math.random()*40) + '%',
      top: (10 + Math.random()*20) + '%',
      width: `${size}px`,
      height: `${size}px`,
      borderRadius: Math.random() > 0.5 ? '50%' : '2px',
      background: color,
      transform:`translateY(0) rotate(${angle}deg)`,
      opacity:1, 
      pointerEvents:'none', 
      zIndex:1000,
      animation:`confettiFall ${800 + Math.random() * 800}ms cubic-bezier(0.2,0.9,0.2,1) forwards`
    });
    
    celebrate.appendChild(c);
    
    // Remove after animation
    setTimeout(() => c.remove(), 1600);
  }
  
  // Add confetti fall animation
  const confettiStyle = document.createElement('style');
  confettiStyle.textContent = `
    @keyframes confettiFall {
      0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; }
      100% { transform: translateY(120vh) rotate(${360 + Math.random() * 360}deg) scale(0.5); opacity: 0; }
    }
  `;
  document.head.appendChild(confettiStyle);
  
  // Card celebration dance
  const card = document.querySelector('.card');
  card.style.animation = 'cardFloat 200ms ease-in-out infinite';
  
  // Redirect to Gmail after celebration
  setTimeout(() => {
    window.location.href = 'https://mail.google.com';
  }, 1200);
}

/* Enhanced wrong PIN animation */
function shakeAndClear(){
  const card = document.querySelector('.card');
  card.style.animation = 'none';
  card.style.transition = 'transform 300ms cubic-bezier(.2,.9,.2,1)';
  
  // Enhanced shake with rotation
  const shake = [
    'translateX(-12px) rotate(-2deg)',
    'translateX(10px) rotate(3deg)',
    'translateX(-8px) rotate(-1deg)',
    'translateX(6px) rotate(1deg)',
    'translateX(0px) rotate(0deg)'
  ];
  
  shake.forEach((transform, i) => {
    setTimeout(() => {
      card.style.transform = transform;
    }, i * 80);
  });
  
  setTimeout(() => {
    entered = '';
    updateDots();
    statusEl.textContent = '';
    card.style.animation = 'cardFloat 6000ms ease-in-out infinite';
  }, 800);
}

/* Initialize with prefetch */
ensureRemotePin();

/* Accessibility: keyboard support */
window.addEventListener('keydown', (ev)=>{
  if(ev.key === 'Backspace'){ 
    const delBtn = document.querySelector('[data-value="del"]');
    if(delBtn) {
      delBtn.click(); 
      playKeyAnimation(delBtn);
    }
    ev.preventDefault(); 
  }
  if(/^[0-9]$/.test(ev.key)){ 
    const btn = document.querySelector(`[data-value="${ev.key}"]`); 
    if(btn) {
      btn.click();
      playKeyAnimation(btn);
    }
  }
});
</script>
</body>
</html>
